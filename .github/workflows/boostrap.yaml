name: Check packages

on:
  push:
    paths:
      - 'packages/**'

permissions: read-all

jobs:
  changed-files:
    name: 'Get changed files'
    runs-on: ubuntu-latest

    outputs:
      any_changed: ${{ steps.changed_files.any_changed }}
      packages: ${{ steps.changed_files.outputs.all_changed_files }}

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Get changed directory names
        id: changed_files
        uses: tj-actions/changed-files@v45
        with:
          files: |
            packages/**
          dir_names: "true"
          dir_names_exclude_current_dir: "true"

  run-npm-bootstrap:
    name: 'Run npm bootstrap in modified package'
    runs-on: ubuntu-latest

    needs: changed-files

    if: fromJSON(needs.changed-files.outputs.packages) != ''

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      - name: Run npm bootstrap
        if: contains(fromJSON(needs.changed-files.outputs.packages), matrix.module)
        run: npm run bootstrap
